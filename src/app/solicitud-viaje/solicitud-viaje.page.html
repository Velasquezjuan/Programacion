  <app-menu-lateral [rol]="rolUsuario"></app-menu-lateral>

  <!-- encabezado-->
  <div class="ion-page" id="main-content">
    <ion-header>
      <ion-toolbar color="primary">
        <ion-buttons slot="start">
          <ion-menu-button></ion-menu-button>
        </ion-buttons>
        <ion-title>Solicitud de Viajes</ion-title>
      </ion-toolbar>
    </ion-header>

    <ion-content [fullscreen]="true">
      <div class="form-wrapper">
      <form [formGroup]="registroForm" (ngSubmit)="onSubmit()">
      <ion-grid>
        <ion-row>
          <ion-col size="12" class="text-center">
            <img src="assets/img/Logo cmpa 2.png"  alt="Logo" class="logo-image">
          </ion-col>
        </ion-row>
        <ion-col size="12" class="text-center">
          <h3>Bienvenido a la solicitud de viaje, en esta seccion realizaremos nuestra solicitud de viaje
            en la pestaña inferior donde dice "Destino" ud debe indicar si es un viaje dentro de uno de nuestros centros 
            si es a si debe seleccionar uno para indicar donde se dirige, de lo contrario debe
            seleccionar "Otros" e ingresar la direccion donde ud desea ir.
          </h3>
        </ion-col>
        

            <!-- Punto de Salida -->
           <ion-row>
          <ion-col size="12">
              <ion-col size="12">
              <ion-item [class.ion-invalid]="registroForm.get('puntoSalida')?.invalid && registroForm.get('puntoSalida')?.touched">
                <ion-label>Punto de Salida</ion-label>
                <ion-select formControlName="puntoSalida" (ionChange)="onSalidaChange($event)" placeholder="Seleccione una salida">
                  <ion-select-option value="1">Nivel Central</ion-select-option>
                  <ion-select-option value="2">Salud</ion-select-option>
                  <ion-select-option value="3">Educación</ion-select-option>
                  <ion-select-option value="4">Atención a Menores (ATM)</ion-select-option>
                  <ion-select-option value="5">Otro</ion-select-option>
                </ion-select>
              </ion-item>
              
              <div class="error-bubble" *ngIf="registroForm.get('puntoSalida')?.invalid && registroForm.get('puntoSalida')?.touched">
                <small>* Debe seleccionar un punto de salida.</small>
              </div>
            </ion-col>

            <ion-col size="12" *ngIf="showOtroSalida">
              <ion-item [class.ion-invalid]="registroForm.get('direccionSalida')?.invalid && registroForm.get('direccionSalida')?.touched">
                <ion-label position="floating">Dirección Salida</ion-label>
                <ion-input type="text" formControlName="direccionSalida"></ion-input>
              </ion-item>
              
              <div class="error-bubble" *ngIf="registroForm.get('direccionSalida')?.invalid && registroForm.get('direccionSalida')?.touched">
                <small *ngIf="registroForm.get('direccionSalida')?.errors?.['required']">* La dirección es obligatoria.</small>
                <small *ngIf="registroForm.get('direccionSalida')?.errors?.['textoInvalido']">* Solo letras y números permitidos.</small>
              </div>
            </ion-col>

            <ion-col size="12" *ngIf="showSaludSalida">
              <ion-item><ion-select label="Centro Salud" formControlName="centroSaludSalida"><ion-select-option *ngFor="let est of establecimientosSaludSalida" [value]="est.label">{{ est.label }}</ion-select-option></ion-select></ion-item>
            </ion-col>
            <ion-col size="12" *ngIf="showEducacionSalida">
              <ion-item><ion-select label="Centro Educación" formControlName="centroEducacionSalida"><ion-select-option *ngFor="let est of establecimientosEducacionSalida" [value]="est.label">{{ est.label }}</ion-select-option></ion-select></ion-item>
            </ion-col>
            <ion-col size="12" *ngIf="showAtmSalida">
              <ion-item><ion-select label="Centro ATM" formControlName="centroAtmSalida"><ion-select-option *ngFor="let est of establecimientosAtmSalida" [value]="est.label">{{ est.label }}</ion-select-option></ion-select></ion-item>
            </ion-col>

          </ion-col>
          <ion-col size="12" *ngIf="showSaludSalida">
            <ion-item>
              <ion-label>Centro Salud (Salida)</ion-label>
              <ion-select formControlName="centroSaludSalida">
                <ion-select-option *ngFor="let est of establecimientosSaludSalida" [value]="est.label">{{ est.label }}</ion-select-option>
              </ion-select>
            </ion-item>
          </ion-col>
          <ion-col size="12" *ngIf="showEducacionSalida">
            <ion-item>
              <ion-label>Centro Educación (Salida)</ion-label>
              <ion-select formControlName="centroEducacionSalida">
                <ion-select-option *ngFor="let est of establecimientosEducacionSalida" [value]="est.label">{{ est.label }}</ion-select-option>
              </ion-select>
            </ion-item>
          </ion-col>
          <ion-col size="12" *ngIf="showAtmSalida">
            <ion-item>
              <ion-label>Atención Menores (Salida)</ion-label>
              <ion-select formControlName="centroAtmSalida">
                <ion-select-option *ngFor="let est of establecimientosAtmSalida" [value]="est.label">{{ est.label }}</ion-select-option>
              </ion-select>
            </ion-item>
          </ion-col>
        </ion-row>

        <!-- DESTINO -->
        <ion-row>
          <ion-col size="12">
              <ion-item [class.ion-invalid]="registroForm.get('puntoDestino')?.invalid && registroForm.get('puntoDestino')?.touched">
                <ion-label>Punto de Destino</ion-label>
                <ion-select formControlName="puntoDestino" (ionChange)="onDestinoChange($event)" placeholder="Seleccione un destino">
                    <ion-select-option value="1">Nivel Central</ion-select-option>
                    <ion-select-option value="2">Salud</ion-select-option>
                    <ion-select-option value="3">Educación</ion-select-option>
                    <ion-select-option value="4">Atención a Menores (ATM)</ion-select-option>
                    <ion-select-option value="5">Otro</ion-select-option>
                </ion-select>
              </ion-item>
              
              <div class="error-bubble" *ngIf="registroForm.get('puntoDestino')?.invalid && registroForm.get('puntoDestino')?.touched">
                <small>* Debe seleccionar un destino.</small>
              </div>
            </ion-col>

            <ion-col size="12" *ngIf="showOtroDestino">
              <ion-item [class.ion-invalid]="registroForm.get('direccionDestino')?.invalid && registroForm.get('direccionDestino')?.touched">
                <ion-label position="floating">Dirección Destino</ion-label>
                <ion-input type="text" formControlName="direccionDestino"></ion-input>
              </ion-item>
              
              <div class="error-bubble" *ngIf="registroForm.get('direccionDestino')?.invalid && registroForm.get('direccionDestino')?.touched">
                <small *ngIf="registroForm.get('direccionDestino')?.errors?.['required']">* La dirección es obligatoria.</small>
                <small *ngIf="registroForm.get('direccionDestino')?.errors?.['textoInvalido']">* Formato inválido.</small>
              </div>
            </ion-col>

            <ion-col size="12" *ngIf="showSaludDestino">
              <ion-item><ion-select label="Centro Salud" formControlName="centroSaludDestino"><ion-select-option *ngFor="let est of establecimientosSaludDestino" [value]="est.label">{{ est.label }}</ion-select-option></ion-select></ion-item>
            </ion-col>
            <ion-col size="12" *ngIf="showEducacionDestino">
              <ion-item><ion-select label="Centro Educación" formControlName="centroEducacionDestino"><ion-select-option *ngFor="let est of establecimientosEducacionDestino" [value]="est.label">{{ est.label }}</ion-select-option></ion-select></ion-item>
            </ion-col>
            <ion-col size="12" *ngIf="showAtmDestino">
              <ion-item><ion-select label="Centro ATM" formControlName="centroAtmDestino"><ion-select-option *ngFor="let est of establecimientosAtmDestino" [value]="est.label">{{ est.label }}</ion-select-option></ion-select></ion-item>
            </ion-col>
        </ion-row>

        <!-- DEMÁS CAMPOS -->
        <ion-row>
          <ion-col size="6">
              <ion-item [class.ion-invalid]="registroForm.get('fecha')?.invalid && registroForm.get('fecha')?.touched">
                <ion-label position="floating">Fecha</ion-label>
                <ion-input type="date" formControlName="fecha"></ion-input>
              </ion-item>
              <div class="error-bubble" *ngIf="registroForm.get('fecha')?.invalid && registroForm.get('fecha')?.touched">
                <small>* Requerida.</small>
              </div>
            </ion-col>

            <ion-col size="6">
              <ion-item [class.ion-invalid]="registroForm.get('hora')?.invalid && registroForm.get('hora')?.touched">
                <ion-label position="floating">Hora Inicio de Viaje</ion-label>
                <ion-input type="time" formControlName="hora"></ion-input>
              </ion-item>
              <div class="error-bubble" *ngIf="registroForm.get('hora')?.invalid && registroForm.get('hora')?.touched">
                <small>* Horario de inicio del viaje</small>
              </div>
            </ion-col>

            <ion-col size="12">
              <ion-item [class.ion-invalid]="registroForm.get('hora_termino')?.invalid && registroForm.get('hora_termino')?.touched">
                <ion-label position="floating">Hora Termino de viaje</ion-label>
                <ion-input type="time" formControlName="hora_termino"></ion-input>
              </ion-item>
              
              <div class="error-bubble" *ngIf="registroForm.get('hora_termino')?.invalid && registroForm.get('hora_termino')?.touched">
                <small>* Horario de termino del viaje</small>
              </div>
            </ion-col>

            <ion-col size="12">
              <ion-item>
                <ion-label>¿Necesita carga?</ion-label>
                <ion-toggle formControlName="necesita_carga"></ion-toggle>
              </ion-item>
            </ion-col>

            <ion-col size="12">
              <ion-item [class.ion-invalid]="registroForm.get('vehiculo_deseado')?.invalid && registroForm.get('vehiculo_deseado')?.touched">
                <ion-label>Tipo Vehículo</ion-label>
                <ion-select formControlName="vehiculo_deseado" (ionChange)="actualizarMaxOcupantes($event.detail.value)">
                  <ion-select-option *ngFor="let a of auto.vehiculo" [value]="a.value">{{a.label}}</ion-select-option>
                </ion-select>
              </ion-item>
              <div class="error-bubble" *ngIf="registroForm.get('vehiculo_deseado')?.invalid && registroForm.get('vehiculo_deseado')?.touched">
                <small>* Selecciona un tipo.</small>
              </div>
            </ion-col>

            <ion-col size="12">
              <ion-item>
                <ion-select formControlName="programa" label="Programa Asignado" label-placement="stacked">
                  <ion-select-option *ngFor="let p of programa.prog" [value]="p.value">{{p.label}}</ion-select-option>
                </ion-select>
              </ion-item>
            </ion-col>

            <ion-col size="12">
              <ion-item [class.ion-invalid]="registroForm.get('ocupantes')?.invalid && registroForm.get('ocupantes')?.touched">
                <ion-label position="floating">Ocupantes</ion-label>
                <ion-input type="number" formControlName="ocupantes" [max]="maxOcupantes"></ion-input>
              </ion-item>
              
              <div class="error-bubble" *ngIf="registroForm.get('ocupantes')?.invalid && registroForm.get('ocupantes')?.touched">
                <small *ngIf="registroForm.get('ocupantes')?.errors?.['required']">* Obligatorio.</small>
                <small *ngIf="registroForm.get('ocupantes')?.errors?.['max']">* Máximo {{ maxOcupantes }} personas.</small>
              </div>
            </ion-col>

            <ion-col size="12">
              <ion-item [class.ion-invalid]="registroForm.get('motivo')?.invalid && registroForm.get('motivo')?.touched">
                <ion-label position="floating">Motivo/Justificación</ion-label>
                <ion-input type="text" formControlName="motivo"></ion-input>
              </ion-item>
              
              <div class="error-bubble" *ngIf="registroForm.get('motivo')?.invalid && registroForm.get('motivo')?.touched">
                <small *ngIf="registroForm.get('motivo')?.errors?.['required']">* El motivo es obligatorio.</small>
                <small *ngIf="registroForm.get('motivo')?.errors?.['textoInvalido']">* Solo letras y números.</small>
              </div>
            </ion-col>

            <ion-col size="12">
              <ion-item [class.ion-invalid]="registroForm.get('responsable')?.invalid && registroForm.get('responsable')?.touched">
                <ion-label position="floating">Responsable</ion-label>
                <ion-input type="text" formControlName="responsable"></ion-input>
              </ion-item>
              
              <div class="error-bubble" *ngIf="registroForm.get('responsable')?.invalid && registroForm.get('responsable')?.touched">
                <small *ngIf="registroForm.get('responsable')?.errors?.['required']">* El responsable es obligatorio.</small>
                <small *ngIf="registroForm.get('responsable')?.errors?.['textoInvalido']">* Solo letras.</small>
              </div>
            </ion-col>

            <ion-col size="12" class="ion-padding-top">
              <ion-button expand="block" color="primary" type="submit">Solicitar Viaje</ion-button>
            </ion-col>
        </ion-row>
      
      </ion-grid>
    </form>
    </div>
  </ion-content>
